#!/usr/bin/env python3
import argparse
import yaml

from pyrate.core.Job import Job

parser = argparse.ArgumentParser(description="Command line options for pyrate")

# -------------------------------------------------------------------
# Required job configuration file. Could be a list of several.
# A job launches a set of Runs homogeneous in purpose and structure.
# A job is represented by one and only one job_config file, passed
# to this script as indicated below.
# -------------------------------------------------------------------
parser.add_argument(
    "--job_config", "-j", help="job configuration file/s", nargs="+", required=True
)
parser.add_argument(
    "--logging_level", "-l", help="logging level", required=False, default="CRITICAL"
)

args = parser.parse_args()

if __name__ == "__main__":
    for jc in args.job_config:

        stream = open(jc, "r")

        jconfig = yaml.full_load(stream)
        jname = jc.split(".")[0]
        log_level = args.logging_level

        job = Job(jname, jconfig, log_level)

        job.setup()
        job.launch()

# EOF
